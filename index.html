<!DOCTYPE html>
<html>
<head>
    <title>钳工证理论历年真题（机械基础部分）</title>
    <!-- 添加LeanCloud SDK -->
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.13.2/dist/av-min.js"></script>
    <style>
        /* 新增排名相关样式 */
        .rank-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1001;
            display: none;
            font-size: 40px !important;
        }

        .rank-header {
            text-align: center;
            font-size: 48px !important;
            margin-bottom: 40px;
            color: #2196F3;
        }

        .rank-item {
            display: flex;
            justify-content: space-between;
            padding: 20px 0;
            border-bottom: 2px solid #eee;
        }

        .rank-number { width: 100px; }
        .rank-name { flex: 2; }
        .rank-score { flex: 1; text-align: right; }

        .close-rank {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 40px;
            cursor: pointer;
            color: #666;
        }

        /* 原样式保留 */
        .credit { font-size: 40px !important; }
        .input-group h3 { font-size: 36px !important; }
        /* ...（原有全部样式保持不变）... */
    </style>
</head>
<body>
    <div class="container">
        <!-- 新增排名弹窗 -->
        <div class="rank-container" id="rankContainer">
            <div class="close-rank" onclick="closeRank()">×</div>
            <div class="rank-header">实时排名</div>
            <div id="rankList"></div>
        </div>

        <div id="passwordScreen" class="password-box">
            <div class="credit">由高州一职 Mr Li制作</div>
            <div class="input-group">
                <h3>请选择您的姓名：</h3>
                <select id="nameSelect" class="name-select">
                    <option value="" disabled selected>请选择姓名</option>
                </select>
            </div>
            <div class="input-group">
                <h3>请输入访问密码：</h3>
                <input type="password" id="passwordInput" class="input-field" placeholder="密码">
            </div>
            <button class="action-btn" onclick="checkPassword()">进入系统</button>
            <!-- 新增排名按钮 -->
            <button class="action-btn" onclick="showRank()" style="margin-top:20px;background:#9C27B0">查看实时排名</button>
        </div>

        <!-- 原有其他内容保持不变 -->
    </div>

    <script>
        // LeanCloud初始化（替换为你的应用ID和KEY）
        AV.init({
            appId: "TKqnsQafKcRWFpC8tH4TkGEr-MdYXbMMI",
            appKey: "EGWQVMBZ3YA8AJQz2BUGXQq7",
            // serverURL: "https://your_server_url" 
            // 如果国内版需要配置
        });

        // 创建UserScore类
        const UserScore = AV.Object.extend('UserScore');

        // 原学生名单和问题数据保持不变...
        // ...（原有全部JavaScript代码保持不变）...

        // 修改后的submitQuiz函数
        async function submitQuiz() {
            // 原有计算分数逻辑不变...
            // ...（保持原有分数计算逻辑）...

            // 保存/更新分数到LeanCloud
            const query = new AV.Query('UserScore');
            query.equalTo('userName', userName);
            const result = await query.first();

            if (result) {
                if (totalScore > result.get('score')) {
                    result.set('score', totalScore);
                    await result.save();
                }
            } else {
                const newScore = new UserScore();
                newScore.set('userName', userName);
                newScore.set('score', totalScore);
                await newScore.save();
            }

            // 原有显示结果逻辑不变...
        }

        // 新增排名功能函数
        async function showRank() {
            document.getElementById('rankContainer').style.display = 'block';
            const query = new AV.Query('UserScore');
            query.descending('score');
            query.limit(300);
            const results = await query.find();

            let rankHtml = '';
            results.forEach((item, index) => {
                rankHtml += `
                    <div class="rank-item">
                        <div class="rank-number">${index + 1}</div>
                        <div class="rank-name">${item.get('userName')}</div>
                        <div class="rank-score">${item.get('score')}分</div>
                    </div>
                `;
            });

            document.getElementById('rankList').innerHTML = rankHtml || '<div style="text-align:center">暂无数据</div>';
        }

        function closeRank() {
            document.getElementById('rankContainer').style.display = 'none';
        }
    </script>
</body>
</html>
